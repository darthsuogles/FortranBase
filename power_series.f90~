! The Fermat Factorization Method
program fermat_factorization

implicit none

integer, parameter:: double = selected_real_kind(15,307)
integer:: a, a2, b2, n = 1372
real(double):: b, thresh = tiny(1.0_double)

!do n = a, 2

   a = ceiling(sqrt(real(n)))
   a2 = a*a
   b2 = a2 - n
   b = sqrt(real(b2))

   do while (abs(b-int(b)) > thresh .or. (a-int(b))*(a+int(b)) /= n)
      a = a + 1
      a2 = a*a
      b2 = a2 - n
      b = sqrt(real(b2))
!      print *, a, b, b2
   end do

   print *, n, 'factorized as:', &
        a-int(b), a+int(b), (a-int(b))*(a+int(b))

!end do

end program fermat_factorization
